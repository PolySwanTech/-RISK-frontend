<div class="popup-overlay" *ngIf="!showAsCard" (click)="cancel()">
    <div class="rv-modal" [ngClass]="{
    'rv-modal--form': mode === 'FORM',
    'rv-modal--blockers': mode === 'BLOCKERS',
    'rv-modal--details': mode === 'DETAILS'
  }" (click)="$event.stopPropagation()">

        <div class="rv-modal__header">
            <div class="rv-modal__title">
                <span class="rv-emoji">üßæ</span>
                {{ mode === 'DETAILS' ? "D√©tail de l‚Äô√©valuation"
                : mode === 'FORM' ? "√âvaluer le contr√¥le"
                : "√âvaluations en attente" }}
            </div>
        </div>

        <div class="rv-modal__body">
            <ng-container [ngSwitch]="mode">

                <div *ngSwitchCase="'BLOCKERS'">
                    <p>Vous devez d‚Äôabord √©valuer les ex√©cutions pr√©c√©dentes :</p>

                    <div class="list">
                        <div class="item" *ngFor="let b of blockers">
                            <div class="left">
                                <div class="date">Planifi√©e le {{ b.plannedAt | date: 'dd/MM/yyyy' }}</div>
                                <div class="who">Attribu√©e √† {{ b.performedBy }}</div>
                                <span class="badge small" [ngClass]="{
                  'status-realise': b.status === 'ACHIEVED',
                  'status-en-cours': b.status === 'IN_PROGRESS',
                  'status-non-realise': b.status === 'NOT_ACHIEVED'
                }">
                                    {{ b.status }}
                                </span>
                            </div>
                            <div class="right">
                                <button class="btn btn-primary" (click)="startEvaluationFor(b.id)">√âvaluer
                                    maintenant</button>
                                <button class="btn btn-outline" (click)="openDetails(b.id)">D√©tails</button>
                            </div>
                        </div>
                    </div>
                </div>

                <form *ngSwitchCase="'FORM'" (ngSubmit)="submit()" #form="ngForm">
                    <div class="form-group">
                        <label for="evaluation">√âvaluation</label>
                        <select [(ngModel)]="evaluationData.evaluation" name="evaluation" required>
                            <option *ngFor="let option of evaluationOptions" [value]="option">
                                {{ labels[option] }}
                            </option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="resume">R√©sum√©</label>
                        <textarea [(ngModel)]="evaluationData.resume" name="resume" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="comments">Commentaires</label>
                        <textarea [(ngModel)]="evaluationData.comments" name="comments"></textarea>
                    </div>
                </form>

                <div *ngSwitchCase="'DETAILS'">
                    <ng-container *ngIf="evalDetails; else noEvalYet">
                        <div class="rv-section" *ngIf="canValidate && evalDetails.reviewStatus === 'PENDING'">
                            <div class="rv-section__label">Votre retour (obligatoire)</div>
                            <textarea [(ngModel)]="reviewComment" rows="3" class="rv-textarea"
                                placeholder="Votre avis / d√©cision..."></textarea>
                        </div>
                    </ng-container>

                    <ng-template #noEvalYet>
                        <p>Pas d‚Äô√©valuation soumise pour cette ex√©cution.</p>
                    </ng-template>
                </div>

            </ng-container>
        </div>

        <div class="rv-modal__footer">
            <ng-container>
                <button class="btn btn-primary winter-style" (click)="handleAction()">OK</button>
                <button class="btn btn-secondary" (click)="cancel()">Fermer</button>
            </ng-container>
        </div>
    </div>
</div>