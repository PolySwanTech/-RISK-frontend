<div class="popup-overlay" *ngIf="!showAsCard" (click)="cancel()">
    <div class="popup-container" (click)="$event.stopPropagation()">
        <h2>√âvaluer le contr√¥le</h2>

        <form (ngSubmit)="submit()" #form="ngForm">
            <div class="form-group">
                <label for="evaluation">√âvaluation</label>
                <select [(ngModel)]="evaluationData.evaluation" name="evaluation" required>
                    <option *ngFor="let option of evaluationOptions" [value]="option">
                        {{ labels[option] }}
                    </option>
                </select>

            </div>

            <div class="form-group">
                <label for="resume">R√©sum√©</label>
                <textarea [(ngModel)]="evaluationData.resume" name="resume" required></textarea>
            </div>

            <div class="form-group">
                <label for="comments">Commentaires</label>
                <textarea [(ngModel)]="evaluationData.comments" name="comments"></textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Soumettre</button>
                <button type="button" class="btn btn-secondary" (click)="cancel()">Annuler</button>
            </div>
        </form>
    </div>
</div>

<div class="card eval-card" *ngIf="showAsCard">
    <div class="card-content">
        <h3 class="title">
            <span class="dot"></span>
            üü© R√©sultats & observations
        </h3>

        <ng-container *ngIf="evaluationView; else noData">
            <div class="eval-header" *ngIf="evaluationView">
                <div class="eval-left">
                    <span class="section-label">√âvaluation du contr√¥le</span>
                    <span class="pill" [ngClass]="evalClass">{{ evalLabel }}</span>
                </div>

                <div class="eval-right">
                    <span class="chip" [ngClass]="reviewBadgeClass">{{ reviewBadgeLabel }}</span>
                    <span class="meta" *ngIf="evaluationView?.evaluatedAt">
                        √âvalu√©e le {{ evaluationView.evaluatedAt | date:'dd/MM/yyyy' }}
                    </span>
                </div>
            </div>

            <hr class="section-sep" />

            <div class="section">
                <div class="section-label">R√©sum√© des constats</div>
                <div class="box text">3 √©carts d√©tect√©s sur les rapprochements:
                    - Virement de 2,500‚Ç¨ non comptabilis√© (compte 512001)
                    - Frais bancaires de 45‚Ç¨ non rapproch√©s
                    - Erreur de saisie sur l'√©criture du 12/01 (inversion cr√©dit/d√©bit)</div>
            </div>

            <div class="section">
                <div class="section-label">Commentaires de l'ex√©cutant</div>
                <div class="box text">Contr√¥le effectu√© selon la proc√©dure standard.
                    D√©lai de traitement respect√©.
                    Recommandation: automatiser le contr√¥le des frais bancaires r√©currents.</div>
            </div>
        </ng-container>

        <ng-template #noData>
            <div class="empty">Aucune √©valuation disponible.</div>
        </ng-template>
    </div>
</div>

<div class="card validate-card" *ngIf="showAsCard">
    <div class="card-content">
        <h3 class="title">
            <span class="dot dot--purple"></span>
            üü™ Validation / Approbation
        </h3>

        <ng-container *ngIf="evaluationView && hasValidation; else noValidation">
            <div class="val-grid">
                <div class="val-field">
                    <label>Nom du valideur / manager</label>
                    <div class="val-input">{{ evaluationView.reviewedBy || '‚Äî' }}</div>
                </div>

                <div class="val-field">
                    <label>Date de validation</label>
                    <div class="val-input">
                        {{ evaluationView.reviewedAt ? (evaluationView.reviewedAt | date:'dd/MM/yyyy') : '‚Äî' }}
                    </div>
                </div>
            </div>

            <div class="val-status">
                <span class="pill" [ngClass]="reviewBadgeClass">{{ reviewBadgeLabel }}</span>
            </div>

            <div class="val-field full">
                <label>Commentaires ou avis du valideur</label>
                <div class="val-textarea">{{ evaluationView.reviewComment || '‚Äî' }}</div>
            </div>
        </ng-container>

        <ng-template #noValidation>
            <div class="empty">Aucune validation enregistr√©e.</div>
        </ng-template>
    </div>
</div>