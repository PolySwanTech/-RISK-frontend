<div class="body-container">
    @if(incident){
    <app-go-back [title]="`D√©tails de l'incident`" [subtitle]="incident.reference"
        [buttons]="goBackButtons"></app-go-back>
    <div class="view-container">
        <div class="info-container">
            <mat-card class="incident-card" [ngStyle]="{'height': !incident.closedAt ? '850px' : '820px'}">
                <mat-card-content>
                    <!-- Timeline des dates -->
                    <div class="timeline-horizontal">
                        <h3 class="timeline-title">
                            <mat-icon>schedule</mat-icon>
                            Chronologie de l'incident
                        </h3>

                        <div class="timeline-row">
                            <div class="timeline-step">
                                <div class="dot red"></div>
                                <div class="date">{{ incident.survenueAt | date: 'dd/MM/yyyy √† HH:mm' }}</div>
                                <div class="label">
                                    <mat-icon fontIcon="place"></mat-icon> Date de survenance
                                </div>
                            </div>

                            <div class="line-gradient"></div>

                            <div class="timeline-step">
                                <div class="dot orange"></div>
                                <div class="date">{{ incident.detectedAt | date: 'dd/MM/yyyy √† HH:mm' }}</div>
                                <div class="label">
                                    <mat-icon fontIcon="search"></mat-icon> Date de d√©tection
                                </div>
                            </div>

                            <div class="line-gradient"></div>

                            <div class="timeline-step">
                                <div class="dot green"></div>
                                <div class="date">{{ incident.declaredAt | date: 'dd/MM/yyyy √† HH:mm' }}</div>
                                <div class="label">
                                    <mat-icon fontIcon="calendar_today"></mat-icon> Date de d√©claration
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Informations principales en cartes -->
                    <mat-card class="general-info-card">
                        <span class="section-header">
                            <span class="pin-emoji">üìå</span>
                            <span>Informations g√©n√©rales</span>
                        </span>

                        <mat-card-content>
                            <div class="info-pairs-grid">
                                <div class="info-field">
                                    <label>Localisation</label>
                                    <div class="info-box">{{ incident.location }}</div>
                                </div>

                                <div class="info-field">
                                    <label>Cause</label>
                                    <div class="info-box">{{ incident.cause.name }}</div>
                                </div>

                                <div class="info-field">
                                    <label>Type de risque</label>
                                    <div class="info-box">{{ incident.riskName }}</div>
                                </div>

                                <div class="info-field">
                                    <label>R√©f√©rence</label>
                                    <div class="info-box">{{ incident.reference }}</div>
                                </div>

                                <div class="info-field">
                                    <label>Libell√©</label>
                                    <div class="info-box">{{ incident.title }}</div>
                                </div>
                            </div>
                        </mat-card-content>
                    </mat-card>


                    <!-- Description -->
                    <div class="description-section">
                        <h3 class="description-title">
                            <mat-icon>description</mat-icon>
                            Description de l'incident
                        </h3>
                        <div class="description-content">
                            <p>{{ incident.commentaire }}</p>
                        </div>
                    </div>
                </mat-card-content>
            </mat-card>

            <app-fichiers [incidentId]="incident.id" [incidentRef]="incident.reference" [closed]="isClosed()"
                style="height: 90%;"></app-fichiers>

        </div>
        <div class="info2-container" style="display: flex; gap: 20px;">
            <!-- Section Pi√®ces jointes -->

            <app-list-suivi [closed]="isClosed()"></app-list-suivi>

            <app-list-impact [closed]="isClosed()"></app-list-impact>
        </div>
    </div>
    }
</div>