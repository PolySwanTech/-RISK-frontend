<app-go-back [title]="'Cr√©ation d\'une cartographie'"></app-go-back>

<mat-card class="main-card">
  <mat-horizontal-stepper [linear]="true" #stepper>
    
    <!-- √âtape 1 : S√©lection -->
    <mat-step>
      <ng-template matStepLabel>S√©lection</ng-template>
      
      <div class="step-content">
        <app-bu-process-accordion *ngIf="!selectedRisk"></app-bu-process-accordion>
        
        <mat-chip-listbox class="selection-chips" *ngIf="selectedRisk">
          <mat-chip>Unit√© m√©tier : {{ selectedBU?.name || "N/R" }}</mat-chip>
          <mat-chip>Processus : {{ selectedProcess?.name || "N/R" }}</mat-chip>
          <mat-chip highlighted>Risque : {{ selectedRisk.libelle }}</mat-chip>
        </mat-chip-listbox>

        <div class="step-actions">
          <button 
            mat-raised-button 
            class="btn-primary" 
            (click)="stepper.next()"
            [disabled]="!selectedRisk">
            Suivant ‚Üí
          </button>
        </div>
      </div>
    </mat-step>

    <!-- √âtape 2 : √âvaluation Brute -->
    <mat-step [editable]="false">
      <ng-template matStepLabel>√âvaluation Brute</ng-template>
      
      <app-evaluation-brute
        *ngIf="selectedRisk && selectedBU && selectedProcess"
        [selectedRisk]="selectedRisk"
        [selectedBU]="selectedBU"
        [selectedProcess]="selectedProcess"
        (onNext)="onEvaluationBruteSaved($event); stepper.next()"
        (onPrevious)="stepper.previous()">
      </app-evaluation-brute>
    </mat-step>

    <!-- √âtape 3 : √âvaluation Nette -->
    <mat-step [editable]="false">
      <ng-template matStepLabel>√âvaluation Nette</ng-template>
      
      <app-evaluation-nette
        *ngIf="selectedRisk && selectedBU && selectedProcess"
        [selectedRisk]="selectedRisk"
        [selectedBU]="selectedBU"
        [selectedProcess]="selectedProcess"
        [initialRiskLevel]="bruteRiskLevel!"
        [bruteIndicators]="bruteIndicators"
        (onSave)="stepper.next()"
        (onPrevious)="stepper.previous()">
      </app-evaluation-nette>
    </mat-step>

    <!-- √âtape 4 : R√©sultats -->
    <mat-step [editable]="false">
      <ng-template matStepLabel>R√©sultats</ng-template>
      
      <div class="step-content">
        <div class="success-container">
          <div class="success-icon">‚úì</div>
          <h2>√âvaluation Enregistr√©e</h2>
          <p>L'√©valuation du risque a √©t√© enregistr√©e avec succ√®s.</p>
          <button 
            mat-raised-button 
            class="btn-primary" 
            (click)="newEvaluation(); stepper.reset()">
            üîÑ Nouvelle √©valuation
          </button>
        </div>
      </div>
    </mat-step>
    
  </mat-horizontal-stepper>
</mat-card>