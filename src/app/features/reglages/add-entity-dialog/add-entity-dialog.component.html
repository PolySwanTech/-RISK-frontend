<app-base-popup 
  [title]="titlePage" 
  [showClose]="true"
  [actions]="popupActions"
  [dialogRef]="getDialogRef()"
  (close)="goBack()">
  
  <!-- Section Informations -->
  <div class="section">
    <div class="section-header">
      <mat-icon class="section-icon">info</mat-icon>
      <h3 class="section-title">Informations générales</h3>
    </div>
    
    <form [formGroup]="formGroup" class="forms-container">
      <mat-form-field class="full-width" appearance="outline">
        <mat-label>Nom de l'entité</mat-label>
        <input matInput formControlName="name" placeholder="Ex: Direction Financière" required>
        <mat-icon matPrefix>business</mat-icon>
        <mat-error *ngIf="formGroup.get('name')?.hasError('required')">
          Le nom est obligatoire
        </mat-error>
      </mat-form-field>

      <div class="toggle-field">
        <div class="toggle-info">
          <mat-icon class="toggle-icon">domain</mat-icon>
          <div class="toggle-text">
            <label class="toggle-label">Ligne Métier</label>
            <span class="toggle-description">Cette entité est-elle une ligne métier ?</span>
          </div>
        </div>
        <mat-slide-toggle 
          formControlName="lm" 
          [checked]="formGroup.get('lm')?.value"
          color="primary">
        </mat-slide-toggle>
      </div>
    </form>
  </div>

  <!-- Section Hiérarchie -->
  <div class="section">
    <div class="section-header">
      <mat-icon class="section-icon">account_tree</mat-icon>
      <h3 class="section-title">Hiérarchie organisationnelle</h3>
    </div>
    
    <app-select-entities 
      [entiteEnfantId]="data ? data.id : ''"
      [selectId]="BusinessUnit.parentId ? BusinessUnit.parentId : ''"
      (entitieSelected)="entiteChange($event)">
    </app-select-entities>
  </div>

</app-base-popup>