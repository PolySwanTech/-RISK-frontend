<div style="margin: 15px;">
  <app-go-back previousPageName="Gestion des risques" [currentPageName]="pageTitle" />
  <section>
    <div class="form-container">
      <h2>{{pageTitle}}</h2>

      @if(risk){
      <mat-stepper [linear]="false" #stepper>
        <mat-step [stepControl]="riskForm" label="Informations de base">
          <form [formGroup]="riskForm">
            <mat-form-field class="full-width">
              <mat-label>Titre du risque</mat-label>
              <input matInput formControlName="titre" placeholder="Entrez le titre du risque" />
            </mat-form-field>

            <mat-form-field class="full-width">
              <mat-label>Catégorie Bâloise</mat-label>
              <mat-select formControlName="balois1">
                <mat-option *ngFor="let cb of categoriesBaloise" [value]="cb.name">
                  {{ cb.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field class="full-width">
              <mat-label>Sous-catégorie Bâloise</mat-label>
              <mat-select formControlName="balois2">
                <mat-option *ngFor="let sub of sousCategoriesFiltered" [value]="sub.name">
                  {{ sub.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>

             <mat-form-field class="full-width">
              <mat-label>Processus </mat-label>
              <mat-select formControlName="process">
                <mat-option *ngFor="let p of process" [value]="p.id">
                  {{ p.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <div class="actions">
              <button mat-raised-button class="btn-primary" [disabled]="riskForm.invalid" matStepperNext>Suivant</button>
            </div>
          </form>
        </mat-step>

        <mat-step [stepControl]="riskForm2" label="Autres info">
          <form [formGroup]="riskForm2">

            <mat-form-field>
              <mat-label>Type d'Impact</mat-label>
              <mat-select formControlName="impactType" placeholder="Choisissez un type d'impact" required>
                @for(impact of impactTypes; track impact){
                <mat-option [value]="impact">
                  {{ impactLabels[impact] }}
                </mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field>
              <mat-label>Niveau</mat-label>
              <mat-select formControlName="level" placeholder="Choisissez un niveau de risque" required>
                @for(level of riskLevels; track level){
                <mat-option [value]="level">
                  {{ riskLabels[level] }}
                </mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field class="full-width">
            <mat-label>Probabilité que le risque se produise</mat-label>
            <input
              matInput
              type="number"
              formControlName="probability"
              placeholder="Entrez la probabilité que le risque se produise"
              step="any"  
              min="0"
              max="100"
            >
          </mat-form-field>

          <mat-form-field class="full-width">
            <mat-label>Description du risque</mat-label>
            <textarea matInput formControlName="description" placeholder="Entrez la description du risque"></textarea>
          </mat-form-field>
            
          </form>

          <div class="actions">
            <button mat-raised-button class="btn-red" matStepperPrevious>Retour</button>
            <button mat-raised-button class="btn-primary" [disabled]="riskForm.invalid || riskForm2.invalid" (click)="createRisk()">Soumettre</button>
          </div>
        </mat-step>
      </mat-stepper>
      }
    </div>
  </section>
</div>